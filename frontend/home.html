<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home | Plant Care - Smart Disease Detection</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="data:,">
</head>

<body>

<!-- ================= NAVBAR ================= -->
<nav class="navbar">
  <div class="nav-container">
    <div class="nav-brand">
      <span class="brand-icon">üåø</span>
      <span class="brand-text">PlantCare</span>
    </div>

    <ul class="nav-menu">
      <li><a href="home.html" class="nav-link active">Home</a></li>
      <li><a href="#how-it-works" class="nav-link">How It Works</a></li>
      <li><a href="#diseases" class="nav-link">Diseases</a></li>
      <li><a href="#about" class="nav-link">About</a></li>
      <li><button class="nav-btn logout-btn-nav" onclick="logout()">Logout</button></li>
    </ul>

    <button class="nav-toggle" id="navToggle">
      <span></span><span></span><span></span>
    </button>
  </div>
</nav>

<!-- ================= HERO ================= -->
<section class="hero">
  <div class="hero-content">
    <h1>üì∏ Scan Your Plant</h1>
    <p>Capture or upload a clear leaf image</p>

    <!-- Camera Preview -->
    <div id="cameraPreview" class="camera-preview" style="display:none">
      <video id="videoElement" autoplay playsinline></video>
      <canvas id="canvasElement" style="display:none"></canvas>
      <div class="camera-controls">
        <button onclick="capturePhoto()">üì∏ Capture</button>
        <button onclick="stopCamera()">‚úï Cancel</button>
      </div>
    </div>

    <!-- Image Preview -->
    <div id="imagePreview" class="image-preview" style="display:none">
      <img id="previewImg">
      <button class="remove-btn" onclick="removeImage()">‚úï</button>
    </div>

    <!-- Upload -->
    <div class="upload-options">
      <button onclick="openCamera()" id="cameraBtn">üì∑ Open Camera</button>

      <label class="upload-box" id="uploadLabel">
        <input type="file" id="imageInput" accept="image/*">
        <span id="uploadText">Select from Gallery</span>
        <span class="upload-hint">Max 10MB</span>
      </label>
    </div>

    <button id="predictBtn" onclick="predict()" disabled>
      üîç Detect Disease
    </button>

    <div id="loading" style="display:none">
      <p>Analyzing image‚Ä¶</p>
    </div>
  </div>
</section>

<!-- ================= HOW IT WORKS ================= -->
<section id="how-it-works">
  <h2>How It Works</h2>
  <p>Upload ‚Üí Analyze ‚Üí Get Results</p>
</section>

<!-- ================= DISEASES ================= -->
<section id="diseases">
  <h2>Common Plant Diseases</h2>
  <p>Early Blight, Late Blight, Leaf Spot, Viral Infections</p>
</section>

<!-- ================= ABOUT ================= -->
<section id="about">
  <h2>About PlantCare</h2>
  <p>
    PlantCare helps farmers and gardeners detect plant diseases early using AI.
  </p>
</section>

<!-- ================= FOOTER ================= -->
<footer class="footer">
  <p>&copy; 2024 PlantCare. All rights reserved.</p>
</footer>

<!-- ================= SCRIPTS ================= -->

<script src="translations.js"></script>

<script>
/* ========== TRANSLATIONS & FLOW ========== */
window.translations = typeof translations !== "undefined" ? translations : {};
if (typeof applyTranslations === "function") applyTranslations();

const hasLanguage = localStorage.getItem("selectedLanguage");
if (!hasLanguage) location.href = "language-select.html";

/* ========== ELEMENTS ========== */
const imageInput = document.getElementById("imageInput");
const predictBtn = document.getElementById("predictBtn");
const uploadText = document.getElementById("uploadText");

/* ========== FILE UPLOAD ========== */
imageInput.addEventListener("change", function () {
  const file = this.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = e => {
    document.getElementById("previewImg").src = e.target.result;
    document.getElementById("imagePreview").style.display = "block";
    document.getElementById("uploadLabel").style.display = "none";
    predictBtn.disabled = false;
    uploadText.textContent = file.name;
  };
  reader.readAsDataURL(file);
});

/* ========== CAMERA ========== */
let stream = null;

function openCamera() {
  if (!navigator.mediaDevices) return alert("Camera not supported");

  navigator.mediaDevices.getUserMedia({ video: true })
    .then(s => {
      stream = s;
      document.getElementById("videoElement").srcObject = s;
      document.getElementById("cameraPreview").style.display = "block";
      document.getElementById("uploadLabel").style.display = "none";
      document.getElementById("cameraBtn").style.display = "none";
    })
    .catch(() => alert("Camera permission denied"));
}

function capturePhoto() {
  const video = document.getElementById("videoElement");
  const canvas = document.getElementById("canvasElement");
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;

  canvas.getContext("2d").drawImage(video, 0, 0);
  canvas.toBlob(blob => {
    const file = new File([blob], "camera.jpg", { type: "image/jpeg" });
    const dt = new DataTransfer();
    dt.items.add(file);
    imageInput.files = dt.files;

    document.getElementById("previewImg").src = canvas.toDataURL();
    document.getElementById("imagePreview").style.display = "block";
    predictBtn.disabled = false;
    stopCamera();
  });
}

function stopCamera() {
  if (stream) stream.getTracks().forEach(t => t.stop());
  stream = null;
  document.getElementById("cameraPreview").style.display = "none";
  document.getElementById("cameraBtn").style.display = "block";
}

/* ========== REMOVE IMAGE ========== */
function removeImage() {
  imageInput.value = "";
  document.getElementById("imagePreview").style.display = "none";
  document.getElementById("uploadLabel").style.display = "block";
  predictBtn.disabled = true;
}

/* ========== PREDICT ========== */
async function predict() {
  const file = imageInput.files[0];
  if (!file) return alert("Select an image");

  document.getElementById("loading").style.display = "block";
  predictBtn.disabled = true;

  const formData = new FormData();
  formData.append("file", file);

  try {
    const res = await fetch(
      "https://plantcare-2crhpwt0e-yuvrajbhagyedhs-projects.vercel.app/predict",
      { method: "POST", body: formData }
    );

    if (!res.ok) throw new Error("Prediction failed");

    const data = await res.json();
    alert(`Disease: ${data.disease}\nConfidence: ${data.confidence}%`);
  } catch (e) {
    alert("Failed to analyze image");
    console.error(e);
  } finally {
    document.getElementById("loading").style.display = "none";
    predictBtn.disabled = false;
  }
}

/* ========== LOGOUT ========== */
function logout() {
  localStorage.clear();
  location.href = "index.html";
}
</script>

</body>
</html>
